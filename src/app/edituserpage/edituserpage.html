<div *ngIf="mostrarSucesso" class="popup-sucesso">
  Usu√°rio alterado com sucesso!
</div>

<div *ngIf="mostrarConfirmacao" class="popup-confirmacao">
  <div class="popup-box">
    <p>Voc√™ realmente deseja salvar as altera√ß√µes?</p>
    <button class="cancelar" (click)="cancelarCriacao()">Cancelar</button>
    <button class="confirmar" (click)="confirmarCriacao()">Sim</button>
  </div>
</div>

<div class="profile-container">
  <!-- Sidebar -->
  <div class="profile-sidebar">
    <div class="profile-photo-card">
      <div class="photo-placeholder"></div>
      <div class="name">Lucas Tri Nascimento</div>
    </div>

    <div class="profile-permissions">
      <div class="title">Permiss√µes</div>
      <button class="option" (click)="goAcesspage()" routerLink="/acessos">Acessos</button>
      <button type="button" class="option usuarios-btn" (click)="toggleUsuariosSubmenu()"
        [attr.aria-expanded]="isUsuariosSubmenuVisible" aria-haspopup="true">
        Usu√°rios
        <span class="caret" [class.open]="isUsuariosSubmenuVisible">‚ñæ</span>
      </button>

      <div *ngIf="isUsuariosSubmenuVisible" class="submenu" role="menu">
        <button type="button" (click)="goAddUserPage()" class="sub-option">Adicionar Usu√°rio</button>
        <button type="button" (click)="goDeleteUser()" class="sub-option">Excluir Usu√°rio</button>
      </div>

      <button type="button" class="option usuarios-btn" (click)="toggleGruposSubmenu()"
        [attr.aria-expanded]="isGruposSubmenuVisible" aria-haspopup="true">
        Grupos de Usu√°rio
        <span class="caret" [class.open]="isGruposSubmenuVisible">‚ñæ</span>
      </button>

      <div *ngIf="isGruposSubmenuVisible" class="submenu" role="menu">
        <button type="button" (click)="goAddGroupPage()" class="sub-option">Adicionar Grupo</button>
        <button type="button" (click)="goEditGroupPage()" class="sub-option">Editar Grupo</button>
        <button type="button" (click)="goDeleteGroupPage()" class="sub-option">Deletar Grupo</button>
      </div>
    </div>

    <div class="profile-security">
      <div class="title">Seguran√ßa</div>
      <button class="option" (click)="abrirModalSenha()">Alterar Senha</button>
    </div>
  </div>

  <!-- Conte√∫do -->
  <div class="profile-content">
    <div class="card-editar">
      <h2>EDITAR USU√ÅRIO</h2>

      <!-- Seletor de usu√°rio -->
      <div class="form-group">
        <label for="usuario">Usu√°rio</label>
        <select id="usuario" [(ngModel)]="usuarioSelecionado" (change)="carregarDados()" [disabled]="formDisabled">
          <option value="" disabled selected hidden>Selecione</option>
          <option *ngFor="let u of usuarios" [value]="u.nome">{{ u.nome }}</option>
        </select>
      </div>

      <!-- Campos s√≥ aparecem ap√≥s sele√ß√£o -->
      <div *ngIf="usuarioSelecionado">
        <div class="form-row">
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" [(ngModel)]="emailSelecionado" [disabled]="formDisabled" />
          </div>
          <div class="form-group status">
            <label>Situa√ß√£o:</label>
            <span (click)="usuarioAtivo = !usuarioAtivo" [ngClass]="usuarioAtivo ? 'ativo' : 'inativo'"
              style="cursor:pointer;">
              {{ usuarioAtivo ? 'ATIVO' : 'INATIVO' }}
            </span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="cpf">CPF</label>
            <input type="text" id="cpf" [(ngModel)]="cpfSelecionado" [disabled]="formDisabled" />
          </div>

          <div class="form-group">
            <label for="masp">MASP</label>
            <input type="text" id="masp" [(ngModel)]="maspSelecionado" [disabled]="formDisabled" />
          </div>
        </div>

        <!-- Toggle alterar senha -->
        <div class="form-group toggle-container">
          <label class="switch">
            <input type="checkbox" [(ngModel)]="alterarSenha">
            <span class="slider round"></span>
            Alterar senha do usu√°rio?
          </label>
        </div>

        <!-- Campo aparece s√≥ se marcar o toggle -->
        <div class="form-group" *ngIf="alterarSenha">
          <label for="novaSenha">Nova senha</label>
          <input type="password" id="novaSenha" [(ngModel)]="novaSenha" placeholder="Digite a nova senha" />
        </div>

        <!-- Confirma√ß√£o -->
        <div class="form-group">
          <label for="senha">Digite sua senha para confirmar</label>
          <input type="password" id="senha" [(ngModel)]="senhaConfirmacao" placeholder="Senha" />
        </div>

        <!-- Bot√£o -->
        <button class="btn-salvar" (click)="abrirConfirmacao()" [disabled]="!formValido() || formDisabled">
          SALVAR ALTERA√á√ïES
        </button>
      </div>
    </div>
  </div>
</div>


<div class="modal-overlay" *ngIf="mostrarModalSenha">
  <div class="modal-content">
    <h3>Recuperar Senha</h3>
    <p>Digite seu email para receber o link de redefini√ß√£o:</p>

    <input type="email" [(ngModel)]="emailRecuperacao" placeholder="Digite seu email" [disabled]="modalProcessando" />

    <div class="modal-buttons">
      <button class="btn-confirm" (click)="enviarEmailRecuperacao()"
        [disabled]="!emailValidoRecuperacao() || modalProcessando">
        Enviar
      </button>
      <button class="btn-cancel" (click)="fecharModalSenha()" [disabled]="modalProcessando">
        Cancelar
      </button>
    </div>

    <div *ngIf="modalSucesso" class="modal-success">
      üìß Se este email estiver cadastrado, voc√™ receber√° um link para redefinir sua senha.
    </div>
  </div>
</div>
